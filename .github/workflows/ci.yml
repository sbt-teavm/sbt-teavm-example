on:
  pull_request:
  push:
jobs:
  test:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-java@v3
      with:
        java-version: 11
        distribution: adopt
        cache: sbt
    - id: install_cc
      uses: rlalik/setup-cpp-compiler@master
      with:
        compiler: latest
    - run: gcc --version
      env:
        CC: ${{ steps.install_cc.outputs.cc }}
        CXX: ${{ steps.install_cc.outputs.cxx }}
    - run: cmake --version
    - run: sbt "teavmC"
    - run: |
        cd target/scala-2.13/teavm/c
        export LC_ALL=C
        SOURCE_DIR=$(pwd)
        gcc -g -O0 -lrt -lm all.c -o run_test
        ls
        ./run_test
